# basic info
info:
    id: fao-sg-dataset
    base:
        - &d1 semio/ddf--fao--forestry


config:
    # the path to search recipe files to include
    recipes_dir: ./
    # the path to search dictionary files
    dictionary_dir: ../translation_dictionaries
    # the path to search ddf datasets
    ddf_dir: /Users/semio/src/work/Gapminder/airflow/datasets/


ingredients:
    - id: fao-datapoints
      dataset: *d1
      key: "country,year"
      value:
          - forbelbiom
          - forabovbiom
          #- prodfor
          #- forgrosval
          - forest
          - privown
          - forperc
          - plantfor
          - primfor
          - wooremov


cooking:
    datapoints:
        - procedure: run_op
          ingredients:
              - fao-datapoints
          options:
              op:
                  #forest_products_removal_total_dollar: "forgrosval * forest"
                  privately_owned_forest_land_percent: "privown / forest * 100"
                  biomass_stock_in_forest_tons: "(forbelbiom + forabovbiom) * 1000000"
                  forest_land_total_area_ha: "forest * 1000"
                  planted_forest_area_ha: "plantfor * 1000"
                  primary_forest_area_ha: "primfor * 1000"
                  wood_removal_cubic_meters: "wooremov * 1000"
          result: fao-datapoints-op


        - procedure: translate_header
          ingredients:
              - fao-datapoints-op
          options:
              dictionary:
                  #forgrosval: forest_products_removal_per_ha_dollar
                  forperc: forest_coverage_percent
                  country: geo
                  year: time
          result: fao-datapoints-op-translated

        - procedure: filter
          ingredients:
              - fao-datapoints-op-translated
          options:
              item:
                  - biomass_stock_in_forest_tons
                  #- forest_products_removal_per_ha_dollar
                  #- forest_products_removal_total_dollar
                  - privately_owned_forest_land_percent
                  - forest_land_total_area_ha
                  - forest_coverage_percent
                  - planted_forest_area_ha
                  - primary_forest_area_ha
                  - wood_removal_cubic_meters
          result: fao_fore-datapoints-filtered-0
        - procedure: filter
          ingredients:
              - fao_fore-datapoints-filtered-0
          options:
              row:
                  time:
                      $lt: 9999
              debug: true
          result: fao_fore-datapoints-final
