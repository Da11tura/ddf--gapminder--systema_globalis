# recipe for fao food_supply dataset
info:
    id: sg-fao_food-dataset
    base:
        - &d1 semio/ddf--fao--food_supply

config:
    # the path to search recipe files to include
    recipes_dir: ./
    # the path to search dictionary files
    dictionary_dir: ../translation_dictionaries


# define your ingredients and procedures below
ingredients:
    - id: fao_food-datapoints
      dataset: *d1
      key: "country,item,year"
      value:
          - food_supply_kcal_capita_day

    - id: fao_food-countries
      dataset: *d1
      key: country
      value: "*"

include:
    - recipe_gw_common.yaml

cooking:
    datapoints:
        - procedure: translate_header
          ingredients:
              - fao_food-datapoints
          options:
              dictionary:
                  country: geo
                  year: time
                  food_supply_kcal_capita_day: food_supply_kilocalories_per_person_and_day
          result: fao_food-datapoints_
        - procedure: filter
          ingredients:
              - fao_food-datapoints_
          options:
              row:
                  item:
                      $eq: '2901'
          result: fao_food-datapoints-filtered
        - procedure: flatten
          ingredients:
              - fao_food-datapoints-filtered
          options:
              flatten_dimensions:
                  - item
              dictionary:
                  "*": "{concept}"
          result: fao_food-datapoints-flattened

        - procedure: translate_column
          ingredients:
              - fao_food-countries
          options:
              dictionary:
                  base: gw-countries
                  key:  ['gapminder_list', 'alternative_1', 'alternative_2', 'alternative_3',
                         'alternative_4_cdiac', 'pandg', 'god_id', 'alt_5', 'upper_case_name',
                         'arb1', 'arb2', 'arb3', 'arb4', 'arb5', 'arb6', 'name']
                  value: country
              column: name
              target_column: geo
          result: fao_food-countries-aligned
        - procedure: translate_column
          ingredients:
              - fao_food-datapoints-flattened
          options:
              dictionary:
                  base: fao_food-countries-aligned
                  key: country
                  value: geo
              column: geo
          result: fao_food-datapoints-final
