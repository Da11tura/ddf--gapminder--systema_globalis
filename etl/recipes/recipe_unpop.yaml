# basic info
info:
  id: unpop_sg_dataset

ingredients:
  - id: unpop-datapoints
    dataset: ddf--unpop--wpp_pop
    key: "country_code,year,gender,age"
    value: "*"
  - id: unpop-countries
    dataset: ddf--unpop--wpp_pop
    key: country_code
    value: "*"
  - id: unpop-concepts
    dataset: ddf--unpop--wpp_pop
    key: concept
    value: "*"
  - id: unpop-entities
    dataset: ddf--unpop--wpp_pop
    key: [gender, age]
    value: "*"
  - id: gw-entities
    dataset: ddf--gapminder--gapminder_geo_entity_domain
    key: [geo, country]
    value: "*"
  - id: gw-concepts
    dataset: ddf--gapminder--gapminder_world
    key: concept
    value: [female_population_with_projections, male_population_with_projections]

cooking:
  datapoints:
    - procedure: filter
      options:
        dictionary:
          - female_population_with_projections:
              from: population
              country_code: 4
              gender: female
          - male_population_with_projections:
              from: population
              country_code: 4
              gender: male
      ingredients:
        - unpop-datapoints
      result: unpop-datapoints-filtered
    - procedure: align
      ingredients:
        - unpop-datapoints-filtered
      options:
        base: gw-countries
        search_cols: ['alternative_1', 'alternative_2', 'alternative_3',
                      'alternative_4_cdiac', 'pandg', 'god_id', 'alt_5', 'upper_case_name',
                      'code', 'arb1', 'arb2', 'arb3', 'arb4', 'arb5', 'arb6',
                      'name']
  concepts:
    - procedure: identity
      ingredients:
        - gw-concepts
  entities:
    - procedure: merge
      ingredients:
        - gw-entities
        - unpop-entities
      options:
        deep:
          false

